{% extends 'problems/base.html' %}
{% block content %}
<div class="container py-4">
  <h3>Confirm Delete User: {{ user_to_delete.username }}</h3>

  <form method="post" id="deleteForm">
    {% csrf_token %}

    <!-- 顶部主复选框（控制全选/取消） -->
    <div class="form-check mb-3">
      <input class="form-check-input"
         type="checkbox"
         id="masterDelete"
         onchange="toggleAll(this)">
      <label class="form-check-label fw-bold" for="masterDelete">
        Select / deselect all problem records created by this user
      </label>
    </div>

    <!-- 问题列表 -->
    <p class="mb-2">Problems created by this user ({{ problems.count }}):</p>
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:40px;"></th>
            <th>ID</th>
            <th>Title</th>
            <th>Key Words</th>
            <th>Description</th>
            <th>Create Time</th>
          </tr>
        </thead>
        <tbody>
          {% for p in problems %}
          <tr>
            <td>
              <input type="checkbox" name="problem_ids" value="{{ p.id }}" class="row-check">
            </td>
            <td>{{ p.id }}</td>
            <td>{{ p.title }}</td>
            <td>{{ p.key_words|truncatechars:20 }}</td>
            <td>{{ p.description|truncatechars:30 }}</td>
            <td>{{ p.create_time|date:'Y-m-d H:i' }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-center">No records</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <button class="btn btn-danger" type="submit">Confirm Delete</button>
    <a class="btn btn-secondary ms-2" href="{% url 'user_list' %}">Cancel</a>
  </form>
</div>

<script>
/* 顶部主复选框联动所有行复选框 */
function toggleAll(master) {
  document.querySelectorAll('.row-check').forEach(chk => {
    chk.checked = master.checked;
  });
}
/* 行复选框任意变化时同步主复选框状态 */
document.querySelectorAll('.row-check').forEach(chk => {
  chk.addEventListener('change', () => {
    const total = document.querySelectorAll('.row-check').length;
    const checked = document.querySelectorAll('.row-check:checked').length;
    document.getElementById('masterDelete').checked = (checked === total);
  });
});
</script>
{% endblock %}