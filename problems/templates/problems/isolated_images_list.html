{% extends 'problems/base.html' %}
{% block content %}
<div class="container py-4">
  <h2>Isolated Images</h2>
  <p class="text-muted">The images in list are stored but not used by any items.</p>

  <form id="deleteForm" method="post" action="{% url 'isolated_images_delete' %}">
    {% csrf_token %}
    <div class="table-responsive">
      <table class="table table-sm table-bordered">
        <thead class="table-light">
          <tr>
            <th><input type="checkbox" id="checkAll"></th>
            <th>Preview</th>
            <th>Relative Path</th>
            <th>Size(Bytes)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in isolates %}
          <tr>
            <td><input type="checkbox" name="files" value="{{ item.path }}"></td>
	    <td>
              <img src="{{ item.url }}" style="max-height:60px; cursor: zoom-in;"class="img-thumbnail" data-big="{{ item.url }}" ondblclick="showOriginal(this.dataset.big)">
            </td>
            <td><code>{{ item.path }}</code></td>
            <td>{{ item.size }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4" class="text-center">No isolated images.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <button type="submit" class="btn btn-danger"
            onclick="return confirm('Confirm to delete selected images?')">Delete</button>
  </form>
</div>
<!-- 原图预览 Modal -->
<div class="modal fade" id="imgModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Original Image</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center p-0">
        <img id="modalImg" src="" class="img-fluid" style="max-height: 85vh;">
      </div>
    </div>
  </div>
</div>
<script>
// 全选/取消全选
document.getElementById('checkAll').addEventListener('change', function() {
  document.querySelectorAll('input[name="files"]').forEach(cb => cb.checked = this.checked);
});

function showOriginal(src) {
  const modal = new bootstrap.Modal(document.getElementById('imgModal'));
  document.getElementById('modalImg').src = src;
  modal.show();
}

</script>
{% endblock %}
